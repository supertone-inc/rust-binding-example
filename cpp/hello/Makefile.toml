extend = "../../Makefile.toml"

[tasks.pre-build]
script = '''
#!@shell
mkdir -p ${PROJECT_NAME}/lib
'''

[tasks.post-build.windows]
script = '''
#!@shell
cp target/debug/${PROJECT_NAME}.dll ${PROJECT_NAME}/lib/${PROJECT_NAME}.dll || exit $?
cp target/debug/${PROJECT_NAME}.dll.lib ${PROJECT_NAME}/lib/${PROJECT_NAME}.lib || exit $?
'''

[tasks.post-build.mac]
script = "cp target/debug/lib${PROJECT_NAME}.dylib ${PROJECT_NAME}/lib/lib${PROJECT_NAME}.dylib"

[tasks.post-build.linux]
script = "cp target/debug/lib${PROJECT_NAME}.so ${PROJECT_NAME}/lib/lib${PROJECT_NAME}.so"

[tasks.test]
dependencies = ["build"]
script = '''
#!@shell
cmake -S . -B build || exit $?
cmake --build build || exit $?
cd build && ctest -V || exit $?
'''

[tasks.test.windows]
env.PATH = "${CARGO_MAKE_WORKING_DIRECTORY}\\${PROJECT_NAME}\\lib;${PATH}"
